"use strict";(self.webpackChunkjzer_react_template=self.webpackChunkjzer_react_template||[]).push([[7297,8951],{14710:function(e,t){t.Z=function(e){var t=document.querySelector("#copy");t||((t=document.createElement("textarea")).id="copy",t.style="position:absolute;left:0;bottom:-10000;z-index:-1",document.body.appendChild(t)),t.value=e,t.select(),document.execCommand("copy"),window.$fn.msg.success("复制成功")}},97297:function(e,t,n){n.r(t),n.d(t,{default:function(){return J}});var r=n(67294),a=window.$fn,l=function(e,t){return"bool"===e?t=Boolean(a.isNumber(1*t)?1*t:t):"number"===e&&("true"===t?t=1:"false"===t?t=0:t*=1),t},o=function e(t,n,r){t.forEach((function(t){var o=t.key,i=t.children,c=t.value,u=t.add,s=t.isObject,d=t.isArray,f=t.isObjectData;if(i){if(!u)return;if(a.hasArray(i)){var h=a.isObject(null==i?void 0:i[0]),m=a.isArray(null==i?void 0:i[0]);h?(n[o]={},e(i,n[o])):m&&(n[o]=s?{}:[],function t(n,r,o){n.forEach((function(n){var i={};n.forEach((function(n){if(n.children){var r;if(!n.add)return;i[n.key]=n.isObject?{}:[],a.isArray(null==n||null===(r=n.children)||void 0===r?void 0:r[0])?t(n.children,i[n.key],n.dataType):e(n.children,i[n.key])}else a.isNotEmpty(n.value)&&(i[n.key]=f?"value"===n.key?l(n.dataType,n.value):n.value:"value"===n.key?l(o,n.value):n.value)})),f?a.isNotEmpty(i.value)&&a.isNotEmpty(i.label)&&(r[i.label]=l(o,i.value)):a.hasObject(i)&&r.push(i)}))}(i,n[o],r),d&&!a.hasArray(n[o])&&delete n[o],s&&!a.hasObject(n[o])&&delete n[o])}}else a.isNotEmpty(c)&&(n[o]=c)}))},i=function(e){var t={};return o(e,t),t},c=window.$fn,u=function(e){return c.isNumber(e)?"number":c.isBoolean(e)?"bool":"string"},s=function e(t,n){if(c.hasObject(t)){var r=function(r){var a=t[r];n.forEach((function(t){r===t.key&&(c.isObject(a)&&c.hasArray(t.children)&&t.isObject?(t.add=!0,t.show=!0,e(a,t.children)):c.hasArray(a)&&c.hasArray(t.addData)&&t.isArray?(t.add=!0,t.show=!0,t.children=function(e,t){var n=[];return e.forEach((function(e){var r=c.deepCopy(t),a=function(t){var n=e[t];r.forEach((function(e){if(t===e.key)if(c.isObject(n)&&c.hasArray(e.children)&&(e.isObject||e.isArray))e.add=!0,e.show=!0,s(n,e.children);else if(c.isArray(n)&&e.isLabelValueData&&e.isArray){var r;e.add=!0,e.show=!0,e.dataType=u(null==n||null===(r=n[0])||void 0===r?void 0:r.value),e.children=function(e,t){var n=[];return e.forEach((function(e){var r=c.deepCopy(t);r[0].value=e.label,r[1].value=e.value,n.push(r)})),n}(n,e.addData)}else e.value=n}))};for(var l in e)a(l);n.push(r)})),n}(a,t.addData)):c.isObject(a)&&t.isObjectData&&c.hasArray(t.addData)?(t.add=!0,t.show=!0,t.children=function(e,t){var n=[];for(var r in e){var a=c.deepCopy(t);a[0].value=r,a[1].value=e[r],console.log(e[r]),a[1].dataType=u(e[r]),n.push(a)}return n}(a,t.addData)):t.value=a)}))};for(var a in t)r(a)}else c.hasArray(t)&&t.forEach((function(t){return e(t,n)}))},d=function(e,t){return c.hasArray(t)&&c.hasObject(e)?(s(e,t),t):t},f=n(14710);function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},m.apply(this,arguments)}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==h(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==h(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===h(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e){return function(e){if(Array.isArray(e))return O(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||w(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,l,o,i=[],c=!0,u=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=l.call(n)).done)&&(i.push(r.value),i.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return i}}(e,t)||w(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){if(e){if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(e,t):void 0}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var E=window,j=E.$lazy,k=E.$fn,S=E.$http,C=j.load((function(){return n.e(4484).then(n.bind(n,74484))})),N=j.load((function(){return Promise.all([n.e(490),n.e(2577),n.e(4448),n.e(1498),n.e(5817),n.e(3041)]).then(n.bind(n,41233))})),A=j.load((function(){return Promise.all([n.e(490),n.e(2577),n.e(4448),n.e(3928),n.e(3985),n.e(1498),n.e(6942),n.e(7999),n.e(4302)]).then(n.bind(n,70554))})),x=j.load((function(){return Promise.all([n.e(490),n.e(2577),n.e(4448),n.e(3928),n.e(3985),n.e(557),n.e(249),n.e(197),n.e(9242),n.e(9501),n.e(5742)]).then(n.bind(n,23414))})),T=j.load((function(){return Promise.all([n.e(490),n.e(46),n.e(158)]).then(n.bind(n,60881))})),D=j.load((function(){return Promise.all([n.e(3928),n.e(1451),n.e(9599)]).then(n.bind(n,36595))})),P=[{label:"字符串",value:"string"},{label:"数字",value:"number"},{label:"布尔值",value:"bool"}],J=function(e){var t=e.data,n=e.component,a=e.option,l=g(r.useState(k.deepCopy(t)),2),o=l[0],c=l[1],u=g(r.useState(!1),2),s=u[0],h=u[1],y=g(r.useState(0),2),w=y[0],O=y[1],E=g(r.useState(0),2),j=E[0],J=E[1],$=g(r.useState(0),2),z=$[0],R=$[1],I=function(e){var t=e.name,n=e.title;return r.createElement("h6",{style:{minWidth:120},className:"h28 tr f12 g6 mr5",title:n},t,r.createElement("i",{className:"g9 ml5"},":"))},q=r.useRef({});r.useEffect((function(){if(null!=a&&a.getApi){var e=k.query().id;S.pull(null,null==a?void 0:a.getApi,{id:e}).then((function(e){if(q.current=e,k.hasObject(null==e?void 0:e.wetSetting))try{c((function(t){return v(d(e.wetSetting,t))}))}catch(e){k.msg.error("JSON 格式不正确，请检查")}else c((function(e){return v(d(k.local("templateConfig"),e))}))}))}else c((function(e){return v(d(k.local("templateConfig"),e))}))}),[a]);var _=r.useCallback((function(){return setTimeout((function(){return k.local("templateConfig",i(o))}),200)}),[o]),L=function(e){return Array.from({length:e.length},(function(e,t){return{label:t+1,value:t+1}}))},B=r.useCallback((function(){c(v(o)),_()}),[_,o]),F=["#999","red","blue"],V={title:"生成模板数据",scroll:!0,contentClass:"p10 jzer-form-small",controls:[{label:"清空缓存",ghost:1,click:function(){k.localRemove("templateConfig"),c(k.deepCopy(t)),O((function(e){return e+1}))}},{label:"显示字段名",ghost:1,click:function(){return h((function(e){return!e}))}},null!=a&&a.createJson?{label:"生成 JSON",click:function(){var e=i(o);window.$modalRef().open({title:"生成 JSON",width:"80%",height:"80%",slot:r.createElement("div",{className:"rel wh bcf p10"},r.createElement("textarea",{spellCheck:!1,className:"bor1 wh p10 lh22 r5px",id:"copyTarget",onChange:function(){},style:{background:"#fdf7f2"},value:JSON.stringify(e,null,"\t")})),style:{background:"#f5f5f5",padding:5},onCancel:function(e){return!0},controls:{ok:{label:"复制",click:function(){return(0,f.Z)(document.querySelector("#copyTarget").value)}}}})}}:null,null!=a&&a.importJson?{label:"导入 JSON",click:function(){window.$modalRef().open({title:"生成 JSON",width:"80%",height:"80%",slot:r.createElement("div",{className:"rel wh bcf p10"},r.createElement("textarea",{spellCheck:!1,placeholder:"请输入 JSON",className:"bor1 wh p10 lh22 r5px",id:"importTarget",style:{background:"#fdf7f2"}})),style:{background:"#f5f5f5",padding:5},onCancel:function(e){return!0},controls:{ok:{label:"导入",click:function(){try{var e=document.querySelector("#importTarget").value,n=JSON.parse(e);c(d(n,k.deepCopy(t))),k.msg.success("导入成功"),window.$modalRef().close()}catch(e){k.msg.error("JSON 格式不正确，请检查")}}}}})}}:null,{label:"预览",click:function(){var e=i(o);if(!k.hasObject(e))return k.msg.warning("未添加配置");window.$modalRef().open({title:"预览页面",slot:r.createElement("div",{className:"rel wh"},n(e)),full:!0,style:{background:"#f5f5f5",padding:5},onCancel:function(e){return!0},controls:{ok:0}})}},null!=a&&a.saveApi?{label:"保存",click:function(){var e,t=i(o);if(!k.hasObject(t))return k.msg.warning("未添加配置");S.post(null,null==a?void 0:a.saveApi,{param:b(b({},q.current),{},p({},null!==(e=null==a?void 0:a.jsonStr)&&void 0!==e?e:"json",JSON.stringify(t)))}).then((function(){k.msg.success("保存成功"),k.back()}))}}:null,null!=a&&a.back?{mode:"back"}:null]};return r.createElement(C,V,function e(t){var n=t.data,a=t.index,l=void 0===a?0:a,o=t.hasChildren,i=t.show,c=t.isTwo,u=t.isObjectData,d=o?{border:"1px ".concat(F[l-1]," dotted"),padding:"5px",borderRadius:5}:null;return 1==++l&&(o=!1),r.createElement("ul",{key:w,className:"".concat(c?"fx":"fv","  ex"),hidden:!0!==i,style:b({gap:5,marginLeft:45*(l-1)},d)},k.hasArray(n)&&n.map((function(t,n){var a,o={value:t.value,onChange:function(e){t.value=e,_()}},i=r.createElement("div",{className:"fx fxm ex"},r.createElement(A,m({className:"ex"},o)),u&&"value"===t.key&&r.createElement("div",{className:"ml10"},r.createElement(x,{width:85,hint:"",value:t.dataType,label:"数据类型",data:P,onChange:function(e){t.dataType=e,_()}})));switch(t.type){case"select":i=r.createElement(x,m({className:"ex"},o,{width:160,data:t.data}));break;case"switch":i=r.createElement(T,o)}var d=t.children?r.createElement("li",null,r.createElement("div",{className:"fxm"},r.createElement(I,{name:s?t.key:t.title,title:t.key}),r.createElement("div",{className:"fxm"},r.createElement(D,{value:t.show,label:"展开",disabled:0===t.children.length,bool:!0,onChange:function(e){t.show=e,B()}}),r.createElement(D,{value:t.add,label:"添加",disabled:0===t.children.length,bool:!0,onChange:function(e){t.add=e,t.show=e,B()}}),t.isLabelValueData&&r.createElement("div",{hidden:!t.show,className:"mr10"},r.createElement(x,{width:85,value:t.dataType,hint:"",label:"数据类型",data:P,onChange:function(e){t.dataType=e}})),l>1&&t.addData&&r.createElement(r.Fragment,null,r.createElement(N,{size:"mini",label:"添加",style:{height:22},onClick:function(){0===t.children.length?(t.children.push(k.deepCopy(t.addData)),t.show=!0,t.add=!0):t.show?(t.children.push(k.deepCopy(t.addData)),J((function(e){return e+1}))):t.show=!0,B()}}),r.createElement(N,{size:"mini",label:"清空",ghost:!0,className:"ml10",style:{height:22},onClick:function(){t.children=[],t.show=!1,t.add=!1,B()}})))),t.children&&(k.isObject(null===(a=t.children)||void 0===a?void 0:a[0])?r.createElement("div",{className:"fx",style:{gap:5}},e({data:t.children,hasChildren:!0,index:l,show:t.show,isTwo:t.isTwo,isObjectData:t.isObjectData})):r.createElement("div",{className:"fv rel",style:{gap:5},key:j},t.children.map((function(n,a){return r.createElement("div",{key:a,className:" rel ".concat(t.isTwo?"fxm":"fx")},e({data:n,hasChildren:!0,index:l,show:t.show,isTwo:t.isTwo,isObjectData:t.isObjectData}),r.createElement("div",{className:"ml10"},r.createElement(N,{hidden:!0!==t.show,size:"mini",style:{height:22},label:"删除",onClick:function(){t.children.splice(a,1),0===t.children.length&&(t.add=!1,t.show=!1),B(),J((function(e){return e-1}))}}),r.createElement("div",{className:"mt5"},r.createElement(x,{p:"排序",key:z,value:a+1,width:60,antd:{showSearch:!1},allowClear:!1,data:L(t.children),onChange:function(e){t.children.splice(a,1),t.children.splice(e-1,0,n),B(),R((function(e){return e+1}))}}))))}))))):r.createElement("li",{className:"fxm ".concat(c?"ex":"")},r.createElement(I,{name:s?t.key:t.title,title:t.key}),i);return r.createElement(r.Fragment,{key:n},d)})))}({data:o,show:!0}))}}}]);