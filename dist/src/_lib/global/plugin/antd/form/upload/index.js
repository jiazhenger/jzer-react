import e from"../../../../../_node/@babel/runtime/helpers/esm/extends.js";import n from"../../../../../_node/@babel/runtime/helpers/esm/defineProperty.js";import r from"../../../../../_node/@babel/runtime/helpers/esm/toConsumableArray.js";import t from"../../../../../_node/@babel/runtime/helpers/esm/slicedToArray.js";import l from"react";import{Upload as o}from"antd";import i from"./utils.js";import a from"../../../../../_node/@ant-design/icons/es/icons/LoadingOutlined.js";import s from"../../../../../_node/@ant-design/icons/es/icons/PlusOutlined.js";function u(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function c(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?u(Object(t),!0).forEach((function(r){n(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):u(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var m=window,f=m.$lazy,d=m.$fn,p=m.$config,g=f.load((function(){return import("../../button.js")})),b=function(u,m){var f=u.className,b=u.name,v=u.label;u.children;var h=u.fileName,y=u.value,j=u.disabled,w=u.loading,O=u.onChange,E=u.onChanged;u.out;var P=u.fileType,x=void 0===P?"img":P,L=u.max,C=void 0===L?20:L,T=u.mul,N=u.showUploadList,_=void 0===N||N,z=u.api,A=void 0===z?"upload":z,S=u.param,k=u.btnText,F=void 0===k?"上传文件":k,$=u.size,D=u.listType,G=void 0===D?"picture-card":D,U=u.antd,J=void 0===U?{}:U,M=u.btn,R=void 0===M?{}:M,I=l.useState([]),W=t(I,2),q=W[0],B=W[1],H=l.useState(w),K=t(H,2),Q=K[0],V=K[1],X=l.useState(),Y=t(X,2),Z=Y[0],ee=Y[1],ne="picture-card"===G,re=l.useCallback((function(e){return B(e)}),[]);l.useEffect((function(){T?re(i.getFileList(y)):ee(d.hasArray(y)?y[0]:y)}),[y]);var te=function(){return w?l.createElement(a,{className:"f30"}):l.createElement(s,{className:"f30"})};return!T&&ne&&(_=!1),h||(h=T?"files[]":"file"),J=c({className:f,fileList:q,name:h,action:p.api()+A,listType:G,multiple:T,data:S,disabled:j||w,headers:{Authorization:d.getToken()},beforeUpload:function(e){var n=i.getType(e.type);if(d.hasArray(x)){var r=[],t="";return x.forEach((function(e,l){t+=l===x.length-1?n[e].msg:n[e].msg+"、",n[e].bool&&r.push(0)})),0===r.length&&d.msg.warning("仅允许上传".concat(t,"!"),5),0!==r.length}if("excel"===x){var l=n.excel.bool;return l||d.msg.warning("仅允许上传".concat(n.excel.msg,"!"),5),l}if("img"===x){var o=n.img.bool;o||d.msg.warning("仅允许上传".concat(n.img.msg,"!"),5);var a=e.size/1024/1024<C;return a||d.msg.warning("图片必必须小于 20M!",5),o&&a}return"any"===x||(d.msg.warning("未允许的上传文件类型",5),!1)},showUploadList:_,onChange:function(e){var t=e.file,l=e.fileList,o=t.status,a=t.response;if("uploading"===o)B(l),V(!0);else if("done"===o){var s=null!=a?a:{},u=s.data,m=s.msg,f=s.code;if(200===f)if(d.msg.success("上传成功"),"img"===x){var g=null;re((function(e){var n=[];if(T)u=i.getFileList(u,t),n=(u=[].concat(r(e),r(u)).map((function(e,n){return c(c({},e),{},{uid:e.url})}))).filter((function(e){return e.url})),g=n.map((function(e){return e.url}));else if(u=i.getFileList(u),n=ne?[]:u,d.hasArray(u)){var l=u[0].url;g=l}return n})),T||ee(g);var h=b?{model:n({},b,g)}:null;null==E||E(c({value:g,label:v,name:b},h)),null==O||O(g)}else null==E||E(u),null==O||O(u),V(!1);else f===p.noLoginCode||f===p.LoginExpireCode?(d.msg.error(m),setTimeout((function(){return d.go("/login")}),200)):(d.msg.error(null!=m?m:"文件上传失败"),re((function(e){return e.filter((function(e){return e.url}))})));V(!1)}else"removed"===o||"error"===o&&(d.msg.error("".concat(t.name," 文件上传失败!")),re((function(e){return e.filter((function(e){return e.url}))})),V(!1))},onPreview:function(e){var n=e.url;/\.(gif|jpg|jpeg|png|GIF|JPEG|JPG|PNG)$/.test(n)?window.$imageModalRef().open({src:n}):window.open(n)},onRemove:function(e){var r;re((function(n){var t=n.indexOf(e),l=n.slice();l.splice(t,1),r=l.map((function(e){return e.url}))})),J.multiple||(r=null);var t=b?{model:n({},b,r)}:null;null==E||E(c({value:r,label:v,name:b},t)),null==O||O(r)}},J),l.createElement(o,J,ne?J.multiple?l.createElement(te,null):l.createElement(l.Fragment,null,Z?l.createElement("img",{src:Z,alt:"上传图片",style:{maxWidth:"100%",display:"inline-block"}}):l.createElement(te,null),Q&&Z&&l.createElement("div",{className:"abs_lt i10 fxmc",style:{width:104,height:104,background:"rgba(0,0,0,.2)"}},l.createElement(a,{style:{color:p.mainColor,fontSize:30}}))):l.createElement(g,e({stop:!1,loading:Q,disabled:j,mode:"upload",size:$},R),l.createElement("span",null,F)))};export{b as default};
