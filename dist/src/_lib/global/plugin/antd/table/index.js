import e from"../../../../_node/@babel/runtime/helpers/esm/extends.js";import t from"../../../../_node/@babel/runtime/helpers/esm/toConsumableArray.js";import n from"../../../../_node/@babel/runtime/helpers/esm/slicedToArray.js";import r from"../../../../_node/@babel/runtime/helpers/esm/defineProperty.js";import l,{useState as a,useRef as o,useEffect as i,useCallback as u,useImperativeHandle as s}from"react";import{Table as c}from"antd";import{VList as d}from"virtuallist-antd";import f from"./utils/tool.js";function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v=window,g=v.$fn,y=v.$config,h=v.$http,b=v.$lazy,A=v.$,w=b.load((function(){return import("../pagination.js")})),j=b.load((function(){return import("../empty.js")})),x=b.load((function(){return import("../loading.js")})),R=b.load((function(){return import("../../../../private/component/temp/Controls.js")})),O=function(r,p){var v,b,O,E,S,z,k=r.className,N=r.style,P=r.data,q=void 0===P?[]:P,C=r.cols,T=void 0===C?[]:C,F=r.components,I=r.pag,_=r.prefix,K=r.suffix,$=r.simple,D=r.loadingSize,H=r.size,B=void 0===H?"middle":H,L=r.width,M=void 0===L?"100%":L,W=r.idStr,G=void 0===W?y.pullIdName:W,J=r.loading,Q=r.height,U=r.init,V=void 0===U||U,X=r.isNoMb,Y=r.isIndex,Z=r.pb,ee=void 0===Z?"pb10":Z,te=r.row;r.keys;var ne=r.onKeysChange,re=r.onRow;r.resize;var le=r.max,ae=void 0===le?50:le,oe=r.rightSlot,ie=r.api,ue=r.ctrApi,se=r.addApi,ce=r.modApi,de=r.infoApi,fe=r.delApi,pe=r.clearApi,me=r.paging,ve=void 0===me||me,ge=r.onLoading,ye=r.onSuccess,he=r.setName,be=r.controls,Ae=r.search,we=void 0===Ae?{}:Ae;r.isRows;var je=r.isSubmitForm,xe=r.onChange,Re=r.value,Oe=void 0===Re?[]:Re,Ee=r.antd,Se=r.emptyText;q=g.getArray(q),G=Y?"index":G,g.hasArray(q)&&Y&&(q=q.map((function(e,t){return m(m({},e),{},{index:t})})));var ze=a({data:q,loading:J}),ke=n(ze,2),Ne=ke[0],Pe=ke[1],qe="auto"===Q,Ce=0!==ve&&!1!==ve,Te=o();i((function(){if(je){var e=g.isArray(Oe)?Oe:[];te?We(e):(Y&&(e=function(e,t){return m(m({},e),{},{index:t})}),setTimeout((function(){return Pe({data:t(e)})}),50))}}),[te,Y,je,Oe]);var Fe=function(e){qe||function(e){var t=Te.current;if(t){if(!g.isNumber(e))return t.querySelector(".ant-table-body").scrollTop;t.querySelector(".ant-table-body").scrollTop=e}}(null!=e?e:0)},Ie=u((function(e){var t=null!=e?e:{},n=t.param,r=t.query,l=t.arg,a=t.scroll,o=t.resetEmpty,i=t.resetSearch;n=g.getResult(n),n=g.getSubmitParam(we.data,n),r=g.getResult(r),(l=g.getResult(l))&&(Pe.arg=l),ie&&(null==ge||ge(!0),h.paging(Pe,ie,{param:n,query:r,arg:l,paging:ve,onEnd:function(e){return null==ge?void 0:ge(!1)},setName:he||(Y?function(e,t){return{index:t}}:null),setParam:null==we?void 0:we.setParam,resetEmpty:o,resetSearch:i}).then((function(e){var t=e.data,l=e.rows;null!=te&&te.keys&&Ue(te.keys),1===a?Fe(window.innerHeight):0===a||Fe(),null==ye||ye(l||t,{param:n,query:r})})))}),[]),_e=function(){var e=f.getParam(g.getResult(we.data)),t=g.getResult(null==we?void 0:we.param),n=g.getResult(null==we?void 0:we.query);Ie({param:m(m({},e),t),query:n,scroll:!0})};i((function(){V&&_e()}),[]);var Ke=a([]),$e=n(Ke,2),De=$e[0],He=$e[1];i((function(){return g.hasArray(T)&&He(function(e){if(e=g.getResult(e),!Array.isArray(e))return console.log("cols 必须是一个数组");e=e.filter((function(e){return g.hasObject(e)}));var n,r=g.getResult(be);if(g.hasObject(r)){var a,o=null!==(a=r.size)&&void 0!==a?a:"small";"small"===B&&(o="mini");var i=r.data,u=r.align,s=void 0===u?"center":u,c=r.right,d=void 0===c?1:c,f=m({title:"操作",width:120,align:s,fixed:d?"right":"left",render:function(e,t,n){return l.createElement(R,{size:o,align:s,data:null==i?void 0:i(e,n),table:{ctrApi:ue,clearApi:pe,delApi:fe,infoApi:de,modApi:ce,addApi:se,record:e,api:ie,idStr:G,tableRef:Ze},isTable:!0})}},r);return d?[].concat(t(e),[f]):[f].concat(t(e))}return null!==(n=e)&&void 0!==n?n:[]}(T))}),[T]);var Be=a(null!==(v=null==te?void 0:te.keys)&&void 0!==v?v:[]),Le=n(Be,2),Me=Le[0],We=Le[1],Ge=["checkbox","radio"],Je=g.isObject(te)&&g.hasArray(Ne.data)?m({columnWidth:50,type:null!=te&&te.type?Ge[null==te?void 0:te.type]:Ge[0],selectedRowKeys:Me,onChange:function(e,t){Ue(e,t)},onSelect:function(e,t,n){},onSelectAll:function(e,t,n){},getCheckboxProps:function(e){var t=(null!=te?te:{}).disabledKeys;if(g.isFunction(t)){var n=null==t?void 0:t(e);return e.disabled=n,{disabled:n}}if(g.hasArray(t)){var r=t.includes(e[G]);return e.disabled=r,{disabled:r}}return{}}},null==te?void 0:te.antd):null,Qe=u((function(){te&&g.hasArray(Me)&&Ue([])}),[Me]),Ue=u((function(e,n){var r,l;if(g.hasArray(Ne.data)){var a=null!=te&&te.type?g.hasArray(e)?e:[e]:e;te.keys=a,We(t(a)),null==ne||ne(t(a)),je&&(null==xe||xe(a)),null==te||null===(r=te.change)||void 0===r||r.call(te,{keys:te.type?null!==(l=null==e?void 0:e[0])&&void 0!==l?l:null:e,rows:g.hasArray(n)?function(){return te.type?null==n?void 0:n[0]:n}:function(){return Ye(e)},tableRef:Ze})}}),[Ne.data]),Ve=u((function(){return g.isObject(te)?te.type?g.hasArray(Me)?Me[0]:null:null!=Me?Me:[]:null!=te&&te.type?null:[]}),[Me,te]),Xe=function(e){return Ue(e.map((function(e){return e[G]})))},Ye=u((function(){var e,t,n=null!==(e=0===arguments.length?Me:arguments[0])&&void 0!==e?e:[],r=Ne.data.filter((function(e){var t;return null==n||null===(t=n.includes)||void 0===t?void 0:t.call(n,e[G])}));return null!=te&&te.type?null!==(t=r[0])&&void 0!==t?t:null:r}),[te,Ne.data,Me]),Ze={refresh:function(e){return Ie({scroll:null==e||e})},search:function(e){var t=null!=e?e:{},n=t.param,r=t.query,l=t.arg,a=t.scroll,o=void 0===a||a;we.query=m(m({},null==we?void 0:we.query),r),Ie({param:Ce?m(m({},n),{},{page:1}):n,query:we.query,arg:l,scroll:o}),Qe()},reset:function(){var e,t;Pe.model=Ce?{page:1,size:null!==(e=null===(t=Ne.pager)||void 0===t?void 0:t.size)&&void 0!==e?e:y.paging.pageSize}:{},_e()},resetEmpty:function(){Ie({resetEmpty:!0}),Qe()},resetSearch:function(){Ie({resetSearch:!0}),Qe()},refreshClear:function(e){Ie({scroll:null==e||e}),Qe()},getParam:function(){var e;return(null==Ne||null===(e=Ne.pager)||void 0===e?void 0:e.param)||{}},getArg:function(){return Pe.arg||{}},clearKeys:Qe,keys:function(){return 1===arguments.length?Ue(arguments[0]):Ve()},rows:function(){return 1===arguments.length?Xe(arguments[0]):Ye()},data:function(){if(1!==arguments.length)return Ne.data;var e=arguments[0];e=Array.isArray(e)?e:[],Pe((function(){return{data:0===e.length?[]:t(e)}}))},del:function(e){Ne.data.splice(e,1),this.data(Ne.data)},update:function(){Pe((function(){return{data:g.deepCopy(Ne.data)}}))}};s(p,(function(){return Ze}));var et=a(),tt=n(et,2),nt=tt[0],rt=tt[1],lt=l.useRef();i((function(){var e,t=(null==Ne||null===(e=Ne.data)||void 0===e?void 0:e.length)>ae?m(m({},d({height:null!=Q?Q:lt.current.offsetHeight})),F):m({},F);rt(t)}),[Ne.data]);var at=l.createElement(c,e({style:{zIndex:Ne.loading?1:0},rowKey:function(e){return Y?e.index:e[G]},columns:De,dataSource:g.getArray(Ne.data),scroll:{y:!(!g.hasArray(Ne.data)||qe)||null,x:M},sticky:!0,pagination:!1,bordered:!0,rowSelection:Je,onChange:function(e,t,n){var r=null,l=(r="ascend"===n.order?"asc":"descend"===n.order?"desc":0)?{sort:n.field,sort_type:r}:null;l?Pe.model=m(m({},Pe.model),l):(delete Pe.model.sort,delete Pe.model.sort_type),Ie({scroll:!0})},onRow:function(e){return{onClick:function(){if(g.isObject(te)){var t;if(e.disabled)return;var n=te.type,r=te.keys,l=void 0===r?[]:r,a=e[G];if(Me.includes(a)){var o,i=l.findIndex((function(e){return e===a}));l.splice(i,1),null==te||null===(o=te.onRowFalse)||void 0===o||o.call(te,e,Ze)}else{var u,s=e[G];1===n?l=[s]:l.push(s),null==te||null===(u=te.onRowTure)||void 0===u||u.call(te,e,Ze)}Ue(l),null==te||null===(t=te.onRow)||void 0===t||t.call(te,{row:e,keys:Ve(),rows:function(){return Ye(l)},tableRef:Ze}),null==re||re({row:e,keys:l,rows:Ye,tableRef:Ze})}else null==re||re(e)}}},components:nt,expandRowByClick:!0},Ee)),ot=l.createElement(x,{loading:Ne.loading,size:D,style:{zIndex:2}}),it=l.createElement(j,{loading:Ne.loading,data:Ne.data,simple:$,style:{zIndex:1},msg:Se||(!1===V?"请按条件搜索数据":"暂无数据")});return l.createElement("div",{ref:lt,className:"ex rel ".concat(A.css(0===(null==Ne||null===(b=Ne.data)||void 0===b?void 0:b.length),"oh")," ").concat(A.css(!qe,"fv")," ").concat(A.css(!1===I,ee)," jzer-form-small ").concat(A.css(k)),style:m({height:Q},N)},l.createElement("div",{ref:Te,className:"\n\t\t\t\t\tjzer-table ex rel\n\t\t\t\t\tjzer-table-".concat(B,"\n\t\t\t\t\tjzer-table-").concat($?"simple":"no-simple","\n\t\t\t\t\t").concat(A.css((!1===I&&!qe||0===(null==Ne||null===(O=Ne.data)||void 0===O?void 0:O.length))&&!oe,"bbor1")," \n\t\t\t\t\t").concat(g.hasArray(Ne.data)||X?"":"mb10"," \n\t\t\t\t\t").concat(A.css(!qe,"jzer-table-scroll"),"\n\t\t\t\t\t").concat(A.css(oe,"fx"),"\n\t\t\t\t"),style:{minHeight:$?120:180}},oe?l.createElement(l.Fragment,null,l.createElement("div",{className:"rel ex rbor1 bbor1 fv ".concat(A.css(!1===I&&!qe||0===(null==Ne||null===(E=Ne.data)||void 0===E?void 0:E.length),"bbor1"))},at,ot,it),l.createElement("div",{className:"rel fv ml10 ".concat(A.css(oe.className)),style:m({width:oe.width},null==oe?void 0:oe.style)},oe.slot)):at),!oe&&l.createElement(l.Fragment,null,ot,it),g.hasArray(Ne.data)&&!1!==I&&0!==I&&l.createElement("div",{className:"fxm ptb10 ".concat(A.css(!qe&&!oe,"tbor1"))},g.getResult(_,Ne.pager),g.isNoFalse(null==I?void 0:I.showTotal)&&l.createElement("div",{className:"g9 f12 nowrap"},"共 ",null!=Ne&&null!==(S=Ne.pager)&&void 0!==S&&S.total?null==Ne||null===(z=Ne.pager)||void 0===z?void 0:z.total:Ne.data.length," 条数据"),g.getResult(K,Ne.pager),Ce&&l.createElement(w,{pager:Ne.pager,pag:I,className:A.css(!_,"ex"),onChange:function(e,t){Ie({param:{page:e,size:t},scroll:!0}),Qe()}})))};export{O as default};
