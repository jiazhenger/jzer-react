import e from"../../../_node/@babel/runtime/helpers/esm/extends.js";import r from"../../../_node/@babel/runtime/helpers/esm/defineProperty.js";import t from"../../../_node/@babel/runtime/helpers/esm/asyncToGenerator.js";import n from"../../../_node/@babel/runtime/helpers/esm/slicedToArray.js";import o from"../../../_node/@babel/runtime/regenerator/index.js";import a,{useState as l,useRef as i,useCallback as s,useImperativeHandle as u}from"react";import f from"../utils/submit.js";function c(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var b=window,p=b.$fn,d=b.$http,v=b.$config,y=b.$lazy,h=b.$,j=y.hook((function(){return import("../../../global/plugin/antd/modal.js")})),k=y.hook((function(){return import("./SearchTable.js")})),g=function(c,b){var y=l({}),g=n(y,2),O=g[0],R=g[1],w=l(c),x=n(w,2),P=x[0],S=x[1],T=i(),D=i(),E=P.modal,$=P.search,_=P.table,A=s(function(){var e=t(o.mark((function e(t){var n,a,l,i,s,u,f,c,b,y,j,k,g,O,w,x,P,S,E,$,_,N;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=t.tableRef,i=t.id,s=t.bidStr,u=void 0===s?v.pullIdName:s,f=t.sidStr,c=void 0===f?v.postIdName:f,b=t.keyNameStr,y=t.infoApi,j=t.onBackData,k=t.backData,g=t.onEnd,O=t.param,w=t.backParam,x=t.abs,P=t.start,S=t.table,E=null===(n=h.ref(D))||void 0===n||null===(a=n.tableRef)||void 0===a?void 0:a.call(n)){e.next=4;break}return e.abrupt("return",setTimeout((function(){return A(t)}),100));case 4:if($=h.ref(T),i=p.getResult(i),O=p.getResult(O),w=p.getResult(w),_=Boolean(null==S?void 0:S.row),N={config:t,modalRef:$,tableRef:l,modalTableRef:E,start:P},R.ids=i?r({},c,i):null,!y){e.next=18;break}return x||(w=m(r({},u,i),w)),i=w?null:i,e.next=16,d.pull(R,y,{id:i,param:w}).then((function(e){var r=m(m({},N),{},{id:i,param:O,backParam:w,data:e});if(j)null==j||j(r);else if(k)k=p.getResult(k,r),_&&E.keys(k);else if(_)if(p.hasArray(e))E.keys(e);else if(p.hasObject(e)){var t;E.keys(null!==(t=null==e?void 0:e[b])&&void 0!==t?t:[])}null==g||g(r)}));case 16:e.next=20;break;case 18:k?(k=p.getResult(k,N),_&&E.setKeys(k)):null==j||j(N),null==g||g(N);case 20:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),[]),N=s(function(){var e=t(o.mark((function e(r){var t,n,a,l;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(t=null!=r?r:c).onStart,a=h.ref(T),r&&S(r),a.open(),e.next=7,null==n?void 0:n();case 7:(l=e.sent)&&(t.start=l),A(t);case 10:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),[A,c]),B=function(){return h.ref(T).close()};u(b,(function(){return{open:N,close:B,tableRef:function(){return h.ref(D).tableRef()}}}));var I=s((function(){var e=h.ref(T),t=h.ref(D).tableRef(),n=P.tableRef,o=P.label,a=P.keyStr,l={close:B,tableRef:n,modalTableRef:t},i=null;if(null!=_&&_.row){var s=t.keys();l=m({keys:s,rows:t.rows()},l),i=a?r({},a,s):s}var u=E.onOk,c=E.title,b=void 0===c?o:c;if(u)return u(l);f({ajax:R,param:i,submitConfig:P,title:b,tableRef:n,modalTableRef:t,modalRef:e})}),[E,P,null==_?void 0:_.row]);return a.createElement(j,e({ref:T,onOk:I,loading:O.loading},E),a.createElement(k,{ref:D,table:_,search:$}))};export{g as default};
