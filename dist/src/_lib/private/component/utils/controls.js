import l from"../../../../../node_modules/@babel/runtime/helpers/esm/defineProperty.js";import{upload as e}from"../../../common/utils/upload.js";import o from"../../../common/utils/download.js";function i(l,e){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(l);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(l,e).enumerable}))),o.push.apply(o,i)}return o}function a(e){for(var o=1;o<arguments.length;o++){var a=null!=arguments[o]?arguments[o]:{};o%2?i(Object(a),!0).forEach((function(o){l(e,o,a[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(l){Object.defineProperty(e,l,Object.getOwnPropertyDescriptor(a,l))}))}return e}var n=window,r=n.$fn,d=n.$,t=n.$config,u=n.$http,f=function(i){var n,f,s,p,c=i.index,m=i.option,v=i.tableConfig,b=void 0===v?{}:v,g=i.history,w=null!=m?m:{},R=w.label,y=w.mode,k=w.click,A=w.to,h=w.toNext,S=w.link,P=w.fileType,O=w.fileName,j=w.downway,C=void 0===j?"blob":j,D=w.msg,x=w.successText,N=w.api,$=w.infoApi,M=w.onSuccess,I=w.way,B=w.param,T=w.id,E=w.r,K=w.c,W=w.rs,_=w.rc,q=w.mul,z=w.abs,F=w.must,G=w.backData,H=w.backInfo,J=w.backParam,L=w.onBack,Q=w.change,U=w.config,V=r.getResult(U);B=r.getResult(B)||r.getResult(null==V?void 0:V.param),_=r.getResult(_),E=r.getResult(E),K=r.getResult(K),T=r.getResult(T);var X=null!=b?b:{},Y=X.ctrApi,Z=X.row,ll=X.clearApi,el=X.delApi,ol=X.modApi,il=X.addApi,al=X.record,nl=al;Y=Y||(null==V?void 0:V.ctrApi);var rl=null!==(n=null==b?void 0:b.idStr)&&void 0!==n?n:t.pullIdName,dl=null!==(f=(null==m?void 0:m.sidStr)||(null==m?void 0:m.idStr)||(null==b?void 0:b.idStr))&&void 0!==f?f:t.postIdName,tl=null!==(s=(null==m?void 0:m.bidStr)||(null==m?void 0:m.idStr)||(null==b?void 0:b.idStr))&&void 0!==s?s:t.pullIdName,ul=null!==(p=null==m?void 0:m.idStr)&&void 0!==p?p:t.postIdName;nl&&!T&&(T=al[rl]),(ll=(null==V?void 0:V.clearApi)||(null==m?void 0:m.clearApi)||ll)&&(ll=r.isString(ll)?ll:b.api);var fl,sl=r.getResult((null==b?void 0:b.tableRef)||m.tableRef),pl=r.getResult((null==b?void 0:b.searchRef)||m.searchRef),cl=[],ml=null;Z&&(cl=null==sl||null===(fl=sl.keys)||void 0===fl?void 0:fl.call(sl),ml=r.isArray(cl)?sl.rows:function(){return[]});if(k)r.func(k,nl?{tableRef:sl,searchRef:pl,index:c,row:al}:{keys:cl,rows:ml,searchRef:pl,tableRef:sl,label:R});else if(A)d.push(g,A,B);else if(h)d.pushNext(g,h,B);else if(S)window.open(S);else if("img"===y)N?(z||(B=a(l({},ul,T),B)),T=B?null:String(T),u.pull(null,N,{id:T,param:B}).then((function(l){l="data:image/jpg;base64,".concat(l).replace(/[\r\n]/g,""),window.$imageModalRef().open({data:l,preview:!1,title:m.title||R})}))):V&&window.$imageModalRef().open(V);else if("download"===y){var vl;if("url"===C)u[null!==(vl=I)&&void 0!==vl?vl:"pull"](null,N,{param:B,loading:!0,loadingText:R+"中"}).then((function(l){var e=G?G(l):l;window.open(e),r.msg.success("文件下载成功")}));else if("form"===C)o.form(t.api()+N);else{var bl;u[null!==(bl=I)&&void 0!==bl?bl:"download"](null,N,{param:B,loading:!0,loadingText:R+"中"}).then((function(l){o.blob(l,{fileName:r.getResult(O),fileType:P}),r.msg.success("文件下载成功")}))}}else if("upload"===y){var gl;e({api:N,change:Q,param:B,way:null!==(gl=I)&&void 0!==gl?gl:"post",mul:q})}else if("submit"===y){var wl;I=null!==(wl=I)&&void 0!==wl?wl:"post",u[I](null,N,{param:B}).then((function(){r.msg.success(x||"".concat(R,"成功")),sl&&(E&&sl.refresh(),K&&sl.clearKeys(),!_||E||K||sl.refreshClear()),ll&&r.indexDBRemove(ll),null==M||M({tableRef:sl})}))}else if(["confirm","del","delPop","clear"].includes(y)){var Rl,yl=m.setParam,kl=m.setNewParam,Al=m.isStr;y.includes("del")&&(N=m.api||el||Y||b.api),q=null!==(Rl=q)&&void 0!==Rl?Rl:t.delMul;var hl,Sl,Pl=nl?q?[T]:T:cl;if(Pl||(Pl=q?[T]:T),B=r.getResult(B,{param:B,keys:cl,rows:ml,ids:Pl}),"clear"===y&&(_=1),["del","delPop"].includes(y))I=null!==(hl=I)&&void 0!==hl?hl:null!==(Sl=null==t?void 0:t.delWay)&&void 0!==Sl?Sl:"post",R=t.btnName[y],_=1,W=0;else if("confirm"===y){var Ol,jl;I=null!==(Ol=I)&&void 0!==Ol?Ol:null!==(jl=null==t?void 0:t.confirmWay)&&void 0!==jl?jl:"post"}var Cl=function(){return new Promise((function(e,o){var i;z||(B=a(l({},ul,Al?String(Pl):Pl),B),B=yl?a(a({},B),yl(B)):B,kl&&(B=kl(B))),r.isEmpty(T)&&(T=B?null:String(Pl)),u[null!==(i=I)&&void 0!==i?i:"post"](null,N,{id:T,param:B,loading:"delPop"===y,onError:o}).then((function(l){e(),r.msg.success(x||"".concat(R,"成功")),sl&&(E&&sl.refresh(W),K&&sl.clearKeys(),!_||E||K||sl.refreshClear(W)),ll&&r.indexDBRemove(ll),null==M||M(l)}))}))};"delPop"===y?Cl():r.confirm({msg:D||"确认".concat(R,"此数据？"),onOk:Cl})}else if("formModal"===y||"mod"===y||"list"===y){var Dl,xl,Nl,$l,Ml,Il=a({idStr:rl,sidStr:dl,bidStr:tl,id:T,param:B,abs:z,tableRef:sl,mode:y,label:R},V),Bl=null!==(Dl=null==Il?void 0:Il.form)&&void 0!==Dl?Dl:{};Il.form=a({id:T,way:I,must:F,tableRef:sl,clearApi:ll,param:B,mode:y,label:R,api:Bl.api||Y,r:null!==(xl=V.r)&&void 0!==xl?xl:E,c:null!==(Nl=V.c)&&void 0!==Nl?Nl:K,rc:null!==($l=V.rc)&&void 0!==$l?$l:_,rs:null!==(Ml=V.rs)&&void 0!==Ml?Ml:W},Bl),"mod"===y&&(b.addConfig&&(b.addConfig.mod=!0,b.addConfig.add=!1),Il.form.r=1,Il.form.mod=!0,Il.form.add=!1,Il.backInfo=(null==V?void 0:V.backInfo)||H);var Tl=V.form;Il.modal=null==V?void 0:V.modal,Il.backData=(null==Tl?void 0:Tl.backData)||(null==V?void 0:V.backData)||G,Il.backParam=(null==V?void 0:V.backParam)||J,Il.form.clearApi=ll,Il.form.api=(null==Tl?void 0:Tl.api)||N||ol||Y||b.api,Il.form.refApi=b.api,Il.form.mode=y,!1===$||!1===(null==Tl?void 0:Tl.infoApi)?Il.form.infoApi=!1:!0===$||!0===(null==Tl?void 0:Tl.infoApi)?Il.form.infoApi=(null==Tl?void 0:Tl.api)||N:Il.form.infoApi=(null==Tl?void 0:Tl.infoApi)||$||b.infoApi||Y||b.api,window.$formModalRef().open(Il)}else if("tableModal"===y){var El=a({idStr:rl,sidStr:dl,bidStr:tl,id:T,param:B,r:E,c:K,rs:W,rc:_,abs:z,must:F,way:I,tableRef:sl,label:R,clearApi:ll},V);El.api=(null==V?void 0:V.api)||N,El.infoApi=(null==V?void 0:V.infoApi)||$,El.refApi=b.api,El.backData=(null==V?void 0:V.backData)||G,El.backParam=(null==V?void 0:V.backParam)||J,El.keyStr=(null==V?void 0:V.keyStr)||(null==m?void 0:m.keyStr),window.$tableModalRef().open(El)}else if("modal"===y)window.$modalRef().open(V);else if("back"===y)r.back(),null==L||L();else if("refresh"===y){var Kl,Wl;null===(Kl=window)||void 0===Kl||null===(Wl=Kl.refreshRouter)||void 0===Wl||Wl.call(Kl)}else if("add"===y){var _l,ql;b.addConfig&&(b.addConfig.mod=!1,b.addConfig.add=!0);var zl=a(a({mode:y,backData:G,tableRef:sl},V),b.addConfig),Fl=null!==(_l=zl.form)&&void 0!==_l?_l:{};zl.form=a({r:!Boolean(Z),rc:Boolean(Z),rs:null!==(ql=null==V?void 0:V.rs)&&void 0!==ql?ql:W,api:Fl.api||N||il||Y||b.api,refApi:b.api,clearApi:ll,infoApi:$,mode:y,label:R,param:B,add:!0,mod:!1},Fl),window.$formModalRef().open(a(a({},zl),{},{table:b}))}"mod"!==y&&"add"!==y&&null!=b&&b.addConfig&&(b.addConfig.mod=!1,b.addConfig.add=!1)};export{f as default};
