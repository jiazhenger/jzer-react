import e from"../../../../../node_modules/@babel/runtime/helpers/esm/extends.js";import t from"../../../../../node_modules/@babel/runtime/helpers/esm/defineProperty.js";import n from"../../../../../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js";import l from"../../../../../node_modules/@babel/runtime/helpers/esm/slicedToArray.js";import a from"react";import r from"./utils/getJSON.js";import o from"./utils/backJSON.js";import i from"../../../common/utils/copy.js";function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function s(e){for(var n=1;n<arguments.length;n++){var l=null!=arguments[n]?arguments[n]:{};n%2?c(Object(l),!0).forEach((function(n){t(e,n,l[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):c(Object(l)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(l,t))}))}return e}var u=window,d=u.$lazy,m=u.$fn,f=u.$http,p=d.load((function(){return import("../../template/content/page-content.js")})),h=d.load((function(){return import("../../../global/plugin/antd/button.js")})),b=d.load((function(){return import("../../../global/plugin/antd/form/input.js")})),g=d.load((function(){return import("../../../global/plugin/antd/form/select.js")})),y=d.load((function(){return import("../../../global/plugin/antd/form/switch.js")})),v=d.load((function(){return import("../../../global/plugin/antd/form/checkbox.js")})),w=[{label:"字符串",value:"string"},{label:"数字",value:"number"},{label:"布尔值",value:"bool"}],k=function(c){var u=c.data,d=c.component,k=c.option,E=a.useState(m.deepCopy(u)),O=l(E,2),j=O[0],C=O[1],N=a.useState(!1),x=l(N,2),S=x[0],T=x[1],J=a.useState(0),A=l(J,2),D=A[0],P=A[1],z=a.useState(0),R=l(z,2),$=R[0],q=R[1],_=a.useState(0),F=l(_,2),L=F[0],V=F[1],W=function(e){var t=e.name,n=e.title;return a.createElement("h6",{style:{minWidth:120,margin:"0 5px 0 0"},className:"h28 tr f12 g6",title:n},t,a.createElement("i",{className:"g9 ml5"},":"))},B=a.useRef({});a.useEffect((function(){if(null!=k&&k.getApi){var e=m.query().id;f.pull(null,null==k?void 0:k.getApi,{id:e,loading:!0}).then((function(e){if(B.current=e,m.hasObject(null==e?void 0:e.wetSetting))try{C((function(t){return n(o(e.wetSetting,t))}))}catch(e){m.msg.error("JSON 格式不正确，请检查")}else C((function(e){return n(o(m.local("templateConfig"),e))}))}))}else C((function(e){return n(o(m.local("templateConfig"),e))}))}),[k]);var G=a.useCallback((function(){return setTimeout((function(){return m.local("templateConfig",r(j))}),200)}),[j]),H=function(e){return Array.from({length:e.length},(function(e,t){return{label:t+1,value:t+1}}))},I=a.useCallback((function(){C(n(j)),G()}),[G,j]),K=["red","#ccc","blue"],M=function(e){var t=e.row;return a.createElement(h,{size:"mini",ghost:!0,mode:m.isEmpty(null==t?void 0:t.value)?"mod":"add",label:"".concat(m.isEmpty(null==t?void 0:t.value)?"添加":"编写","事件"),style:{height:22},onClick:function(){return function(e){var t=m.isEmpty(e.value);window.$modalRef().open({title:"编写 JS",width:"99%",height:"99%",slot:a.createElement("div",{className:"rel wh bcf p10"},a.createElement("textarea",{spellCheck:!1,className:"bor1 wh p10 lh22 r5px",id:"jsCodeTarget",style:{background:"#fdf7f2"}})),style:{background:"#f5f5f5",padding:5},onOpen:function(){t||(document.querySelector("#jsCodeTarget").value=e.value)},onCancel:function(){return!0},onOk:function(){return e.value=document.querySelector("#jsCodeTarget").value,G(),!0},controls:{ok:{label:"保存"},after:[{label:"清空",ghost:1,click:function(){document.querySelector("#jsCodeTarget").value="",G()}}]}})}(t)}})},Q={title:"生成模板数据",scroll:!0,contentClass:"p10 jzer-form-small",controls:[{label:"清空缓存",ghost:1,click:function(){m.localRemove("templateConfig"),C(m.deepCopy(u)),P((function(e){return e+1}))}},{label:"显示字段名",ghost:1,click:function(){return T((function(e){return!e}))}},null!=k&&k.createJson?{label:"生成 JSON",click:function(){var e=r(j);window.$modalRef().open({title:"生成 JSON",width:"80%",height:"80%",slot:a.createElement("div",{className:"rel wh bcf p10"},a.createElement("textarea",{spellCheck:!1,className:"bor1 wh p10 lh22 r5px",id:"copyTarget",onChange:function(){},style:{background:"#fdf7f2"},value:JSON.stringify(e,null,"\t")})),style:{background:"#f5f5f5",padding:5},onCancel:function(e){return!0},controls:{ok:{label:"复制",click:function(){return i(document.querySelector("#copyTarget").value)}}}})}}:null,null!=k&&k.importJson?{label:"导入 JSON",click:function(){window.$modalRef().open({title:"生成 JSON",width:"80%",height:"80%",slot:a.createElement("div",{className:"rel wh bcf p10"},a.createElement("textarea",{spellCheck:!1,placeholder:"请输入 JSON",className:"bor1 wh p10 lh22 r5px",id:"importTarget",style:{background:"#fdf7f2"}})),style:{background:"#f5f5f5",padding:5},onCancel:function(e){return!0},controls:{ok:{label:"导入",click:function(){try{var e=document.querySelector("#importTarget").value,t=JSON.parse(e);C(o(t,m.deepCopy(u))),m.msg.success("导入成功"),window.$modalRef().close()}catch(e){m.msg.error("JSON 格式不正确，请检查")}}}}})}}:null,{label:"预览",click:function(){var e=r(j);if(!m.hasObject(e))return m.msg.warning("未添加配置");window.$modalRef().open({title:"预览页面",slot:a.createElement("div",{className:"rel wh"},d(e)),full:!0,style:{background:"#f5f5f5",padding:5},onCancel:function(e){return!0},controls:{ok:0}})}},null!=k&&k.saveApi?{label:"保存",click:function(){var e,n=r(j);if(!m.hasObject(n))return m.msg.warning("未添加配置");f.post(null,null==k?void 0:k.saveApi,{param:s(s({},B.current),{},t({},null!==(e=null==k?void 0:k.jsonStr)&&void 0!==e?e:"json",JSON.stringify(n)))}).then((function(){m.msg.success("保存成功"),m.back()}))}}:null,null!=k&&k.back?{mode:"back"}:null]};return a.createElement(p,Q,function t(n){var l=n.data,r=n.index,o=void 0===r?0:r,i=n.hasChildren,c=n.open,u=n.isOpen,d=n.show,f=n.isTwo,p=n.isObjectData,k=n.isArray,E=i?{border:"1px ".concat(c?"red":K[o-1]," dotted"),padding:10,borderRadius:5}:null;return 1===++o&&(i=!1),a.createElement("ul",{key:D,className:"".concat(f||!f&&k&&!0!==c||u&&!0!==c?"fx":"fv","  ex"),hidden:!0!==d,style:s({gap:5,marginLeft:45*(o-1)},E)},m.hasArray(l)&&l.map((function(n,l){var r,i={value:n.value,onChange:function(e){n.value=e,G()}},s=a.createElement("div",{className:"fxm ex"},a.createElement(b,e({className:"ex"},i)),p&&"value"===n.key&&a.createElement("div",{className:"ml10"},a.createElement(g,{width:85,hint:"",value:n.dataType,label:"数据类型",data:w,onChange:function(e){n.dataType=e,G()}})));switch(n.type){case"number":s=a.createElement(b,e({type:"number",className:"ex"},i));break;case"select":s=a.createElement(g,e({className:"ex"},i,{width:160,data:n.data}));break;case"switch":s=a.createElement(y,i);break;case"function":s=a.createElement(M,{row:n});break;case"jsx":s=a.createElement("div",{className:"g9 f12 h28"},"仅代码中配置")}var d=!0!==c&&(!f&&k||u),E=n.children?a.createElement("li",{hidden:n.isLabelValueData||d},a.createElement("div",{className:"fxm"},a.createElement(W,{name:S?n.key:n.title,title:n.key}),a.createElement("div",{className:"fxm"},a.createElement(v,{value:n.add,label:"添加",disabled:0===n.children.length,bool:!0,onChange:function(e){n.add=e,n.show=e,I()}}),a.createElement(v,{value:n.show,label:"展开",disabled:0===n.children.length,bool:!0,onChange:function(e){n.show=e,I()}}),n.isLabelValueData&&a.createElement("div",{hidden:!n.show,className:"mr10"},a.createElement(g,{width:85,value:n.dataType,hint:"",label:"数据类型",data:w,onChange:function(e){n.dataType=e}})),o>1&&n.addData&&a.createElement(a.Fragment,null,a.createElement(h,{size:"mini",label:"添加",style:{height:22},onClick:function(){0===n.children.length?(n.children.push(m.deepCopy(n.addData)),n.show=!0,n.add=!0):n.show?(n.children.push(m.deepCopy(n.addData)),q((function(e){return e+1}))):n.show=!0,I()}}),a.createElement(h,{size:"mini",label:"清空",ghost:!0,className:"mlr10",style:{height:22},onClick:function(){n.children=[],n.show=!1,n.add=!1,I()}})),n.isFunction&&a.createElement(M,{row:n}))),n.children&&(m.isObject(null===(r=n.children)||void 0===r?void 0:r[0])?a.createElement("div",{className:n.isOpen&&!0!==n.open?"fxm":"fx",style:{gap:5}},t({data:n.children,hasChildren:!0,index:o,open:n.open,isOpen:n.isOpen,isArray:n.isArray,show:n.show,isTwo:n.isTwo,isObjectData:n.isObjectData}),n.isOpen&&a.createElement(h,{size:"mini",hidden:!0!==n.show,style:{height:22},label:n.open?"收缩":"展开",onClick:function(){n.open=!n.open,I()}})):a.createElement("div",{className:"fv rel",style:{gap:5},key:$,hidden:!0!==n.show},n.children.map((function(e,l){return a.createElement("div",{key:l,className:" rel ".concat(n.isTwo?"fxm":"fx")},t({data:e,hasChildren:!0,index:o,open:e.open,isOpen:n.isOpen,isArray:n.isArray,show:n.show,isTwo:n.isTwo,isObjectData:n.isObjectData}),a.createElement("div",{className:"ml10 ".concat(n.isTwo||!0!==e.open&&n.isArray?"fxm":"fv"),style:{gap:5}},a.createElement(h,{size:"mini",style:{height:22},label:"删除",onClick:function(){n.children.splice(l,1),0===n.children.length&&(n.add=!1,n.show=!1),I(),q((function(e){return e-1}))}}),!n.isTwo&&a.createElement(h,{size:"mini",style:{height:22},label:e.open?"收缩":"展开",onClick:function(){e.open=!e.open,I()}}),a.createElement(g,{p:"排序",key:L,value:l+1,width:60,antd:{showSearch:!1},allowClear:!1,data:H(n.children),onChange:function(t){n.children.splice(l,1),n.children.splice(t-1,0,e),I(),V((function(e){return e+1}))}})))}))))):a.createElement("li",{hidden:l>2&&d,className:"fxm ".concat(f||d?"ex":"")},a.createElement(W,{name:S?n.key:n.title,title:n.key}),s);return a.createElement(a.Fragment,{key:l},E)})))}({data:j,show:!0}))};export{k as default};
